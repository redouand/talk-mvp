(this.webpackJsonpbrush=this.webpackJsonpbrush||[]).push([[0],{106:function(e,t,n){"use strict";n.r(t);var r=n(1),o=n.n(r),a=n(55),c=n.n(a),i=n(28),u=n.n(i),s=n(56),d=n(58),j=n(10),m=n(108),f=n(57),l=n.n(f),b=n(29),O=n.n(b),p=n(60),v=n(59),h=n(9),I=n(7),g=n(0),w=function(e){var t=e.partner,n=Object(r.useRef)(null);return Object(r.useEffect)((function(){t.myHisPeer.on("stream",(function(e){console.log("the received stream==>",e),n.current.srcObject=e}))})),Object(g.jsx)("audio",{ref:n,autoPlay:!0,controls:!0})},x=n.p+"static/media/join.f2723e70.mp3",R=n.p+"static/media/leave.e069f015.mp3",k=l()("http://localhost:8080"),y=function(){var e=Object(r.useState)(new Audio(x)),t=Object(j.a)(e,1)[0],n=Object(r.useState)(new Audio(R)),o=Object(j.a)(n,1)[0],a=Object(r.useState)(null),c=Object(j.a)(a,2),i=c[0],f=c[1],l=Object(r.useState)({}),b=Object(j.a)(l,2),y=b[0],S=b[1],A=Object(r.useState)({joined:!1,roomId:null}),E=Object(j.a)(A,2),P=E[0],C=E[1],H=Object(r.useState)([]),J=Object(j.a)(H,2),M=J[0],D=J[1],N=Object(r.useRef)({});Object(r.useEffect)((function(){k.on("loadRooms",(function(e){return S(e)})),k.on("updateRoom",function(e){return function(t){if(t.push){var n=t.push,r=n.roomId,o=n.userId,a=n.name;e((function(e){return Object(I.a)(Object(I.a)({},e),{},Object(h.a)({},r,Object(I.a)(Object(I.a)({},e[r]),{},Object(h.a)({},o,{name:a}))))}))}if(t.pop){var c=t.pop,i=c.roomId,u=c.userId;e((function(e){var t=e[i],n=(t[u],Object(p.a)(t,[u].map(v.a)));return Object(I.a)(Object(I.a)({},e),{},Object(h.a)({},i,n))}))}if(t.newRoom){var s=t.newRoom.roomId;e((function(e){return Object(I.a)(Object(I.a)({},e),{},Object(h.a)({},s,{}))}))}}}(S)),k.on("receiveAnswer",(function(e){var t=e.answerSdp,n=e.from;D((function(e){var r,o=e.find((function(e){return e.partnerId===n}));return console.log("putting the answer to app==>",o.partnerId),null===o||void 0===o||null===(r=o.myHisPeer)||void 0===r||r.signal(t),e}))}))}),[]);var T=function(e){return function(t){var n=t.sdp,r=t.from,o=U(e,n,r);D((function(e){return[].concat(Object(d.a)(e),[{partnerId:r,myHisPeer:o}])}))}},U=function(e,t,n){var r=new O.a({initiator:!1,trickle:!1,stream:e});return r.signal(t),r.on("signal",(function(e){k.emit("answer",{to:n,from:k.id,answerSdp:e}),console.log(k.id+" is sending answer")})),r},B=function(e){return function(t){var n=[];t.forEach((function(t){n.push({partnerId:t,myHisPeer:L(t,k.id,e)})})),D(n)}},L=function(e,t,n){var r=new O.a({initiator:!0,stream:n,trickle:!1});return r.on("signal",(function(n){k.emit("offer",{from:t,to:e,sdp:n})})),r},q=function(){var e=Object(s.a)(u.a.mark((function e(n){var r,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.target.parentNode.getAttribute("data-roomid"),t.play(),e.next=4,navigator.mediaDevices.getUserMedia({audio:!0});case 4:o=e.sent,k.on("otherUsers",B(o)),k.on("receiveOffer",T(o)),N.current=o,P.joined?(k.emit("jumpRoom",{prevRoom:P.roomId,currentRoom:r,userId:k.id,name:i}),C({joined:!0,roomId:r})):(k.emit("joinRoom",{roomId:r,userId:k.id,name:i}),C({joined:!0,roomId:r}));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),z=function(e){var t=e.target.parentNode.getAttribute("data-roomid");o.play(),N.current.getTracks()[0].stop(),k.emit("leaveRoom",{roomId:t,userId:k.id}),C({joined:!1,roomId:null})};return Object(g.jsxs)("div",{children:[Object(g.jsx)("form",{onSubmit:function(e){e.preventDefault(),f(e.target.children[0].value),e.target.children[0].value=""},children:Object(g.jsx)("input",{placeholder:"must enter name first"})}),i,Object(g.jsx)("button",{onClick:function(){return k.emit("createRoom",{roomId:Object(m.a)(),userId:k.id})},disabled:null==i,children:"CREATE ROOM"}),Object.keys(y).map((function(e,t){return Object(g.jsxs)("div",{"data-roomid":e,children:[Object(g.jsx)("ul",{children:Object.keys(y[e]).map((function(t,n){return Object(g.jsx)("li",{children:y[e][t].name},n)}))}),P.joined&&P.roomId===e?Object(g.jsx)("button",{onClick:z,children:"Leave"}):Object(g.jsx)("button",{onClick:q,disabled:null==i,children:"Join"})]},t)})),M.length&&M.map((function(e,t){return Object(g.jsx)(w,{partner:e},t)}))]})};c.a.render(Object(g.jsx)(o.a.StrictMode,{children:Object(g.jsx)(y,{})}),document.getElementById("root"))},96:function(e,t){},98:function(e,t){}},[[106,1,2]]]);
//# sourceMappingURL=main.a82d83a1.chunk.js.map