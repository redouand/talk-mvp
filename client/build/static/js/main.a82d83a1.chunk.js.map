{"version":3,"sources":["components/outputAudio.jsx","media/join.mp3","media/leave.mp3","App.js","socket.io/updateRooms.js","index.js"],"names":["OutPutAudio","partner","audioRef","useRef","useEffect","myHisPeer","on","stream","console","log","current","srcObject","ref","autoPlay","controls","socket","SOCKETIO","App","useState","Audio","joinFile","joinSound","leaveFile","leaveSound","name","setName","rooms","setRooms","joined","roomId","joinedStatus","setJoinedStatus","roomInfo","setRoomInfo","ROOMS","scheme","push","userId","pop","restUsers","newRoom","updateRoomEvent","answerSdp","from","roomsInfo","approperiate","find","roomObj","partnerId","signal","receiveOfferEvent","streamVar","sdp","newCommerPeer","addPeer","peer","SimplePeer","initiator","trickle","answer","emit","to","id","otherUsersEvent","OTHERSID","roomInfoTemp","forEach","otherId","createConfiguredPeer","myId","myStream","offer","handleJoinRoom","e","a","target","parentNode","getAttribute","play","navigator","mediaDevices","getUserMedia","audio","prevRoom","currentRoom","handleLeaveRoom","getTracks","stop","onSubmit","preventDefault","children","value","placeholder","onClick","v1","disabled","Object","keys","map","i","length","partnerObj","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.a82d83a1.chunk.js","sourcesContent":["import React, { useEffect, useRef } from 'react'\n\nconst OutPutAudio =  ({partner})=>{\n  const audioRef = useRef(null)\n  useEffect(()=>{\n    partner.myHisPeer.on('stream', (stream)=>{\n      console.log('the received stream==>', stream)\n      audioRef.current.srcObject = stream\n    })\n  })\n  return (\n    <audio ref={audioRef} autoPlay controls></audio>\n  )\n}\n\nexport default OutPutAudio","export default __webpack_public_path__ + \"static/media/join.f2723e70.mp3\";","export default __webpack_public_path__ + \"static/media/leave.e069f015.mp3\";","import React, { useEffect, useRef, useState } from \"react\";\nimport { v1 } from \"uuid\";\nimport SOCKETIO from \"socket.io-client\";\nimport SimplePeer from \"simple-peer\";\n\nimport { updateRoomEvent } from \"./socket.io/updateRooms\";\nimport OutPutAudio from \"./components/outputAudio\";\nimport joinFile from \"./media/join.mp3\";\nimport leaveFile from \"./media/leave.mp3\";\nconst socket = SOCKETIO(\"http://localhost:8080\");\n\nconst App = () => {\n  const [joinSound] = useState(new Audio(joinFile));\n  const [leaveSound] = useState(new Audio(leaveFile));\n  const [name, setName] = useState(null);\n  const [rooms, setRooms] = useState({});\n  const [joinedStatus, setJoinedStatus] = useState({\n    joined: false,\n    roomId: null,\n  });\n  const [roomInfo, setRoomInfo] = useState([]);\n\n  //----REFERENCES\n  const stream = useRef({});\n\n  useEffect(() => {\n    socket.on(\"loadRooms\", (ROOMS) => setRooms(ROOMS));\n    socket.on(\"updateRoom\", updateRoomEvent(setRooms));\n    socket.on(\"receiveAnswer\", ({ answerSdp, from }) => {\n      setRoomInfo((roomsInfo) => {\n        const approperiate = roomsInfo.find(\n          (roomObj) => roomObj.partnerId === from\n        );\n        console.log('putting the answer to app==>', approperiate.partnerId)\n        approperiate?.myHisPeer?.signal(answerSdp);\n        return roomsInfo;\n      });\n    });\n  }, []);\n\n\n\n  //-------------ON RECEIVING OFFER\n  const receiveOfferEvent = (streamVar) =>({ sdp, from }) => {\n    const newCommerPeer = addPeer(streamVar, sdp, from);\n    setRoomInfo((roomsInfo)=>{\n      return [...roomsInfo, { partnerId: from, myHisPeer: newCommerPeer }]\n    });\n  };\n  const addPeer = (stream, sdp, from) => {\n    const peer = new SimplePeer({\n      initiator: false,\n      trickle: false,\n      stream: stream,\n    });\n    peer.signal(sdp);\n    peer.on(\"signal\", (answer) =>{\n      socket.emit(\"answer\", { to: from, from: socket.id, answerSdp: answer })\n      console.log(socket.id + ' is sending answer')\n    });\n    return peer;\n  };\n\n\n\n    //-------------ON SENDING OFFER\n  const otherUsersEvent = (streamVar) => (OTHERSID) => {\n    const roomInfoTemp = [];\n    OTHERSID.forEach((otherId) => {\n      roomInfoTemp.push({\n        partnerId: otherId,\n        myHisPeer: createConfiguredPeer(otherId, socket.id, streamVar),\n      });\n    });\n    setRoomInfo(roomInfoTemp);\n  };\n  const createConfiguredPeer = (otherId, myId, myStream) => {\n    const peer = new SimplePeer({\n      initiator: true,\n      stream: myStream,\n      trickle: false,\n    });\n    peer.on(\"signal\", (offer) =>{\n      socket.emit(\"offer\", { from: myId, to: otherId, sdp: offer })\n    });\n    return peer;\n  };\n\n\n\n  const handleJoinRoom = async (e) => {\n    const roomId = e.target.parentNode.getAttribute(\"data-roomid\");\n    joinSound.play();\n    const streamVar = await navigator.mediaDevices.getUserMedia({audio: true});\n    socket.on(\"otherUsers\", otherUsersEvent(streamVar));\n    socket.on(\"receiveOffer\", receiveOfferEvent(streamVar));\n    stream.current = streamVar;\n\n    if (joinedStatus.joined) {\n      socket.emit(\"jumpRoom\", {\n        prevRoom: joinedStatus.roomId,\n        currentRoom: roomId,\n        userId: socket.id,\n        name: name,\n      });\n      setJoinedStatus({ joined: true, roomId: roomId });\n    } else {\n      socket.emit(\"joinRoom\", { roomId, userId: socket.id, name });\n      setJoinedStatus({ joined: true, roomId: roomId });\n    }\n  };\n\n  const handleCreateRoom = () =>\n    socket.emit(\"createRoom\", { roomId: v1(), userId: socket.id });\n\n  const handleLeaveRoom = (e) => {\n    const roomId = e.target.parentNode.getAttribute(\"data-roomid\");\n    leaveSound.play();\n    stream.current.getTracks()[0].stop();\n    socket.emit(\"leaveRoom\", { roomId, userId: socket.id });\n    setJoinedStatus({ joined: false, roomId: null });\n  };\n\n  const handleName = (e) => {\n    e.preventDefault();\n    setName(e.target.children[0].value);\n    e.target.children[0].value = \"\";\n  };\n\n\n  return (\n    <div>\n      <form onSubmit={handleName}>\n        <input placeholder=\"must enter name first\" />\n      </form>\n\n      {name}\n\n      <button onClick={handleCreateRoom} disabled={name == null}>\n        CREATE ROOM\n      </button>\n      {Object.keys(rooms).map((roomId, i) => (\n        <div data-roomid={roomId} key={i}>\n          <ul>\n            {Object.keys(rooms[roomId]).map((userId, i) => (\n              <li key={i}>{rooms[roomId][userId].name}</li>\n            ))}\n          </ul>\n          {joinedStatus.joined && joinedStatus.roomId === roomId ? (\n            <button onClick={handleLeaveRoom}>Leave</button>\n          ) : (\n            <button onClick={handleJoinRoom} disabled={name == null}>\n              Join\n            </button>\n          )}\n        </div>\n      ))}\n      {roomInfo.length &&\n        roomInfo.map((partnerObj, i) => (\n          <OutPutAudio key={i} partner={partnerObj} />\n        ))}\n    </div>\n  );\n};\n\nexport default App;\n","export const updateRoomEvent = (setRooms)=>(scheme) => {\n  if (scheme.push) {\n    const { roomId, userId, name } = scheme.push;\n    setRooms((rooms) => {\n      return { ...rooms, [roomId]: { ...rooms[roomId], [userId]: { name } } };\n    });\n  }\n  if (scheme.pop) {\n    const { roomId, userId } = scheme.pop;\n    setRooms((rooms) => {\n      const { [userId]: omit, ...restUsers } = rooms[roomId];\n      return { ...rooms, [roomId]: restUsers };\n    });\n  }\n  if (scheme.newRoom) {\n    const { roomId } = scheme.newRoom;\n    setRooms((rooms) => {\n      return { ...rooms, [roomId]: {} };\n    });\n  }\n};","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);"],"sourceRoot":""}